<extend name="Common/layout_base" />
<block name="ext_link">
	<!-- Font Awesome -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
	<!-- Ionicons -->
	<link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
	<!-- DataTables -->
	<link rel="stylesheet" href="__PUBLIC__/admin/plugins/datatables/dataTables.bootstrap.css">
</block>
<block name="content">
<!-- Main content -->
	<section class="content">
		<div class="row">
			<div class="box box-danger">
				<div class="box-header with-border">
					<h4>新增菜单</h4>
					<div class="box-tools pull-right">
		                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
		                <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
		            </div>
				</div>
				<div class="box-body">
					<div class="col-xs-12">
						<form class="form-horizontal" name="add_menu_form" id="add_menu_form" action="javascript:;">
							<div class="col-xs-12">
								<div class="alert alert-warning alert-dismissible" id="explain_warning">
					                <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
					                <h4><i class="icon fa fa-warning"></i> 说明:</h4>
					                1、《控/方》：意思是 控制器/方法; 例如 Sys/sys_list<br/>
									2、css为控制左侧导航顶级栏目前图标样式，具体可查看FontAwesome图标CSS样式
					            </div>
								<small>状态:</small>
								<small>
									<select name="status">
										<option value="1">显示</option>
										<option value="0">不显示</option>
									</select>
								</small>
								<small>父级:</small>
								<small>
									<select name="pid">
										<option value="0">--默认顶级--</option>
											<foreach name="menus_data" item="module">
												<option value="<{$module['id']}>"><{$module['title']}></option>
											</foreach>
									</select>
								</small>
								<small>名称:</small>
								<small>
									<input type="text" name="title">
								</small>
								<small>控制器:</small>
								<small>
									<input type="text" name="controller">
								</small>
								<small>图标:</small>
								<small>
									<input type="text" name="icon">
								</small>
								<small>排序:</small>
								<small>
									<input type="text" name="sort" value="1">
								</small>
								<small>
									<button class="btn btn-xs btn-danger ruleadd" id="add_menu">添加菜单</button>
								</small>
								<br/>
								<br/>
					            <div class="alert alert-success " id="explain_success" style="display: none">
					                <button type="button" class="close" id="explain_success_closs">×</button>
					                <h4><i class="icon fa fa-check"></i> <span id="msg"></span></h4>
					            </div>
					            <div class="alert alert-danger" id="explain_danger" style="display: none">
					                <button type="button" class="close" id="explain_danger_closs">×</button>
					                <h4><i class="icon fa fa-ban"></i> <span id="msg"></span></h4>
					            </div>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
	    <div class="row">
	    	<div class="box">
    			<div class="box-header with-border">
    				<h4 class="box-title">菜单列表</h4>
    			</div>
    			<div class="box-body">
    				<div class="col-xs-12">
	    				<table id="data_table" class="table table-bordered table-hover">
	    					<thead>
				                <tr>
				                  	<th>ID</th>
				                 	<th>菜单名称</th>
				                  	<th>控制器</th>
				                  	<th>菜单状态</th>
				                  	<th>添加时间</th>
				                  	<th>排序</th>
				                  	<th>操作</th>
				                </tr>
			                </thead>
			                <tbody>
			                	<foreach name="menus_data" item="module">
			                		<tr class="danger">
			                			<td><{$module['id']}></td>
			                			<td><{$module['title']}></td>
			                			<td><{$module['controller']}></td>
			                			<td><{$module['status']}></td>
			                			<td><{$module['createtime']|date="Y-m-d H:i:s",###}></td>
			                			<td><{$module['sort']}></td>
			                			<td></td>
			                		</tr>
			                		<if condition="module['menus_list']">
										<foreach name="module['menus_list']" item="menu">
											<tr>
					                			<td><{$menu['id']}></td>
					                			<td>----<{$menu['title']}></td>
					                			<td><{$menu['controller']}></td>
					                			<td><{$menu['status']}></td>
					                			<td><{$menu['createtime']|date="Y-m-d H:i:s",###}></td>
					                			<td><{$menu['sort']}></td>
					                			<td></td>
					                		</tr>
										</foreach>
			                		</if>
			                	</foreach>
			                </tbody>
	    				</table>
    				</div>
    			</div>
	    	</div>
	    </div>
	</section>
</block>
<block name="ext_js">
<!-- DataTables -->
<script src="__PUBLIC__/admin/plugins/datatables/jquery.dataTables.min.js"></script>
<script src="__PUBLIC__/admin/plugins/datatables/dataTables.bootstrap.min.js"></script>
<!-- page script -->
<script>
  	$(function () {
	    $('#data_table').DataTable({
	    	"lengthChange": false,
	    });

	    $('#add_menu').click(function(){
	    	$('#explain_success').fadeOut();
	    	$('#explain_danger').fadeOut();
	    	var data=$('#add_menu_form').serialize();
	    	$.ajax({
	    		url:'__CONTROLLER__/create',
	    		type:'post',
			    datatype:'json',
			    data:data,
			    success:function(msg){
			    	if(typeof(msg.status)=='undefined'){
			            $('#explain_danger').find('#msg').html('系统错误');
				        $('#explain_danger').fadeIn();
			        }else{
			        	if(msg.status==1){
			        		$('#explain_success').find('#msg').html(msg.info);
				            $('#explain_success').fadeIn();
				        }
				        if(msg.status==0){
				        	$('#explain_danger').find('#msg').html(msg.info);
				            $('#explain_danger').fadeIn();
				        }
			        }
			    }
	    	});
	    });

	    $('#explain_success_closs').click(function(){
	    	$('#explain_success').fadeOut();
	    });

	    $('#explain_danger_closs').click(function(){
	    	$('#explain_danger').fadeOut();
	    });
  	});
</script>
</block>